{% extends "base.html" %}

{% block title %}Города Нижегородской области{% endblock %}

{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
  <h1 class="h3 m-0">Города Нижегородской области</h1>

  {% if user.is_authenticated %}
    <a href="{% url 'city_add' %}" class="btn btn-primary">Создать статью</a>
  {% endif %}
</div>

{# Поиск + сортировка #}
<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-12 col-md-7">
    <label class="form-label small text-muted">Поиск города</label>
    <input
      type="text"
      class="form-control"
      name="q"
      placeholder="Например: Дзержинск"
      value="{{ request.GET.q }}"
    >
  </div>

  <div class="col-12 col-md-3">
    <label class="form-label small text-muted">Сортировка</label>
    <select class="form-select" name="sort">
      <option value="pop" {% if request.GET.sort == "pop" or not request.GET.sort %}selected{% endif %}>По населению</option>
      <option value="new" {% if request.GET.sort == "new" %}selected{% endif %}>Сначала новые</option>
      <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>По названию</option>
    </select>
  </div>

  <div class="col-12 col-md-2 d-grid">
    <button type="submit" class="btn btn-dark">Найти</button>
  </div>

  {% if request.GET.q %}
    <div class="col-12">
      <a class="small" href="{% url 'city_list' %}">Сбросить поиск</a>
    </div>
  {% endif %}
</form>

{% if cards %}
  <div class="row g-3">
    {% for c in cards %}
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 soft-shadow border-0">
          {% if c.image %}
            <img src="{{ c.image.url }}" class="card-img-top" style="height:180px; object-fit:cover;" alt="{{ c.title }}">
          {% endif %}
          <div class="card-body">
            <h2 class="h5 mb-1">
              {% if c.slug %}
                <a class="text-decoration-none" href="{% url 'city_detail' c.slug %}">{{ c.title }}</a>
              {% else %}
                <span class="text-danger">{{ c.title|default:"(без названия)" }} — ошибка: пустой slug</span>
              {% endif %}

            </h2>

            {% if c.region %}
              <div class="text-muted small mb-2">{{ c.region }}</div>
            {% endif %}

            {% if c.population %}
              <div class="small text-muted mb-2">Население: {{ c.population }}</div>
            {% endif %}

            {% if c.short_description %}
              <div class="small">{{ c.short_description }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-secondary">
    Ничего не найдено.
  </div>
{% endif %}
{% endblock %}
